#include "headers.h"

U8G2_SSD1306_128X64_NONAME_F_HW_I2C u8g2(U8G2_R0,U8X8_PIN_NONE);

unsigned long previousmillis = 0;
const uint8_t interval = 50;

uint8_t increment = 51;

const unsigned char epd_bitmap_rocket [] PROGMEM = {
	0x00, 0x10, 0x00, 0x00, 0x00, 0x38, 0x00, 0x00, 0x00, 0x38, 0x00, 0x00, 0x00, 0x7c, 0x00, 0x00, 
	0x00, 0x7c, 0x00, 0x00, 0x00, 0xfe, 0x00, 0x00, 0x00, 0xfe, 0x00, 0x00, 0x00, 0xff, 0x01, 0x00, 
	0x00, 0xff, 0x01, 0x00, 0x80, 0x00, 0x02, 0x00, 0x80, 0x00, 0x02, 0x00, 0x40, 0x00, 0x04, 0x00, 
  
	0x40, 0x00, 0x04, 0x00, 0x40, 0x00, 0x04, 0x00, 0x20, 0x00, 0x08, 0x00, 0x20, 0x00, 0x08, 0x00, 
	0x20, 0x00, 0x08, 0x00, 0x10, 0x38, 0x10, 0x00, 0x10, 0xc6, 0x10, 0x00, 0x10, 0x82, 0x10, 0x00, 
	0x10, 0x01, 0x11, 0x00, 0x10, 0x01, 0x11, 0x00, 0x10, 0x01, 0x11, 0x00, 0x10, 0x82, 0x10, 0x00, 
	0x10, 0xc6, 0x10, 0x00, 0x10, 0x38, 0x10, 0x00, 0x10, 0x00, 0x10, 0x00, 0x10, 0x00, 0x10, 0x00, 
	0x10, 0x00, 0x10, 0x00, 0x10, 0x00, 0x10, 0x00, 0x10, 0x00, 0x10, 0x00, 0x10, 0x00, 0x10, 0x00, 
	0x18, 0x00, 0x30, 0x00, 0x3c, 0x00, 0x78, 0x00, 0x3e, 0x00, 0xf8, 0x00, 0x3f, 0x00, 0xf8, 0x01, 
	0x3f, 0x00, 0xf8, 0x01, 0x3f, 0x00, 0xf8, 0x01, 0x7f, 0x00, 0xfc, 0x01, 0x7f, 0x00, 0xfc, 0x01, 
	0x7f, 0x00, 0xfc, 0x01, 0xff, 0xff, 0xff, 0x01
};

void display_time(){

  struct dateTime now = get_time();
  
  unsigned long currentmillis = millis();

  if(currentmillis - previousmillis >= interval){

    previousmillis = currentmillis;

    u8g2.clearBuffer();
    u8g2.setFontMode(1);
    u8g2.setBitmapMode(1);
    u8g2.setDrawColor(1);
    u8g2.drawBox(100, 0, 28, 64);
    u8g2.drawBox(0,0,85,34);
    u8g2.setDrawColor(2);
    u8g2.drawXBMP(102,4,25,42,epd_bitmap_rocket);
    u8g2.drawLine(109, 47, 109, increment);
    u8g2.drawLine(117, 47, 117, increment);
    u8g2.drawLine(113, 48, 113, increment+4);
    u8g2.setFont(u8g2_font_t0_16b_tr);
    u8g2.drawStr(2, 16, now.Date);
    u8g2.drawStr(3, 30, now.Day);
    u8g2.setFont(u8g2_font_helvB08_tr);
    u8g2.drawStr(82, 30, now.per);
    u8g2.setFont(u8g2_font_profont29_tn);
    u8g2.drawStr(8,60,now.Time);
    u8g2.sendBuffer();

    increment = increment +1;
    if(increment > 55){
      increment = 51;
    }
  }
}